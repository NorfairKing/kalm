digraph world {

  imap_server [label="IMAP Server"];

  subgraph cluster_kalm {
    label = "Kalm";
  

    storage [label="email storage"];
    queue [label="Send queue"];
    user [label="User", style=invis];

    storage -> storage [label="Read, Organise"];
    storage -> queue [label="Reply"];

    {
      rank=same;
      rankdir=LR;
      rank [style=invis];
      rank -> queue -> user[style=invis];
    }

    user -> queue [label="Compose"];

  }
  imap_server -> storage  [label="Periodic Synchronisation", dir=both];
  queue -> smtp_server  [label="Scheduled Sending"];

  smtp_server [label="SMTP Server"];
}
